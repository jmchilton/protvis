<tal:var define="global columns python: [{'name': 'protein', 'title': 'Protein'}, {'name':'peptide', 'title': 'Peptide'}, {'name': 'probability', 'title': 'Probability'}]"></tal:var>
<tal:if condition="python: len(results) == 0">None of the ${info.total} proteins matched your filter</tal:if>
<tal:else condition="python: len(results) > 0">
	<tal:if condition="python: info['total'] == 1">Displaying the only result</tal:if>
	<tal:else condition="python: info['total'] > 1">
		<form id="filter_protxml_${info.hash}_basic" onsubmit="FilterCurrent(document.getElementById('filter_protxml_${info.hash}').value); return false;">
			Filter: <input type="text" id="filter_protxml_${info.hash}" value="${info.query}" />&nbsp;<input type="submit" value="Filter" />
		</form>
		<br/>
		<tal:if condition="python: info['total'] == len(results)">Displaying all ${info.matches} results</tal:if>
		<tal:if condition="python: info['total'] > len(results)">Displaying ${info.start}-${info.end} of ${info.matches} results</tal:if>
	</tal:else>
	<br/>
	<table id="results_${info.datafile}" border="1" style="width: 100%;">
	<tr><tal:for repeat="col columns"><th id="${info.type}_results_column_${col.name}" onclick="TableManager.Sort('${info.type}_results','${col.name}');" tal:attributes="class python: 'sort' + funcs.test(sortcol==col.name, funcs.test(sortdsc, ' sort_dsc', ' sort_asc'), '')">${col.title}</th></tal:for></tr>
	<tal:for repeat="row results">
		<tr tal:attributes="class string:info ${row.style}${repeat.row.odd}">
			<td tal:attributes="class python:funcs.test(len(row.HitInfo['indistinguishable_protein']) > 0, 'notice', '')+repeat.row.odd">${row.HitInfo.protein}
				<tal:if condition="python: len(row.HitInfo['indistinguishable_protein']) > 0">
					<span class="indistinguishable" tal:attributes="title python:'Indistinguishable from ' + str(len(row.HitInfo['indistinguishable_protein'])) + ' other protein' + funcs.test(len(row.HitInfo['indistinguishable_protein']) > 1, 's', '')  + '. Click for details'" onclick="DisplayIndistinguishableProtein('${row.HitInfo.protein}', ${info.datafile}, ${row.ProteinOffset})">+<tal:echo content="python: len(row.HitInfo['indistinguishable_protein'])"></tal:echo></span
				</tal:if>
			</td>
			<td tal:attributes="class python:funcs.test(len(row.HitInfo['indistinguishable_peptide']) > 0, 'notice', '')+repeat.row.odd"><span id="peptide_${info.hash}_${repeat.row.index}" class="link" onclick="SearchPeptide('${row.HitInfo.peptide}');" tal:content="python: funcs.render_peptide(row.HitInfo)"></span>
				<tal:if condition="python: len(row.HitInfo['indistinguishable_peptide']) > 0">
					<span class="indistinguishable" tal:attributes="title python:'Indistinguishable from ' + str(len(row.HitInfo['indistinguishable_peptide'])) + ' other peptide' + funcs.test(len(row.HitInfo['indistinguishable_peptide']) > 1, 's', '')  + '. Click for details'" onclick="DisplayIndistinguishablePeptide('${row.HitInfo.peptide}', ${info.datafile}, ${row.PeptideOffset})">+<tal:echo content="python: len(row.HitInfo['indistinguishable_peptide'])"></tal:echo></span>
				</tal:if>
			</td>
			<td style="text-align:center;">${row.HitInfo.probability}</td>
		</tr>
		<tal:if condition="python: row.PeptideMatches > 1">
			<tr tal:attributes="class string:${row.style}${repeat.row.odd}"><td tal:attributes="colspan python: len(columns)"><span class="link" onclick="DisplayProtein('${row.HitInfo.protein}', ${info.datafile}, ${row.ProteinOffset});"><span tal:omit-tag="" tal:content="python: row.PeptideMatches-1"></span> more peptide<tal:if condition="python: row.PeptideMatches > 2">s</tal:if> found for this protein</span></td></tr>
		</tal:if>
	</tal:for>
	</table>
	<script>
		TableManager.Add("results_${info.datafile}", "${sortcol}", <tal:echo content="python: funcs.test(sortdsc, 'false', 'true')"></tal:echo>, "${info.datafile}", "${url}");
		/*var ids = [<span tal:omit-tag="" tal:repeat="row results">"peptide_${info.hash}_${repeat.row.index}", </span>];
		var tt = new dijit.DynamicTooltip({
			connectId: ids,
			href: "/tooltip/peptide?file=${info.file}&n=${info.datafile}&peptide=",
			position: ["below", "above"]
		})
		Tooltips.push(tt);
		delete ids;*/
	</script>
</tal:else>
